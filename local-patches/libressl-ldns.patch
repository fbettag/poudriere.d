From 8a04ace41e307c5e64928da873bd9ed84bb75e61 Mon Sep 17 00:00:00 2001
From: "W.C.A. Wijngaards" <wouter@nlnetlabs.nl>
Date: Sat, 12 Jul 2014 11:18:59 +0200
Subject: [PATCH] * Fix configure to make ldns compile with LibreSSL 2.0

Conflicts:
	Changelog
---
 configure.ac             | 2 +-
 examples/ldns-signzone.c | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git configure.ac configure.ac
index 5f25c7d..ba0a3ce 100644
--- configure.ac
+++ configure.ac
@@ -302,7 +302,7 @@ tmp_LIBS=$LIBS
 
 ACX_WITH_SSL_OPTIONAL
 
-AC_CHECK_FUNCS([EVP_sha256])
+AC_CHECK_FUNCS([EVP_sha256 ENGINE_load_cryptodev])
 
 # for macosx, see if glibtool exists and use that
 # BSD's need to know the version...
diff --git examples/ldns-signzone.c examples/ldns-signzone.c
index ffdd3c0..c19c8b4 100644
--- examples/ldns-signzone.c
+++ examples/ldns-signzone.c
@@ -473,7 +473,9 @@ main(int argc, char *argv[])
 		case 'E':
 			ENGINE_load_builtin_engines();
 			ENGINE_load_dynamic();
+#ifdef HAVE_ENGINE_LOAD_CRYPTODEV
 			ENGINE_load_cryptodev();
+#endif
 			engine = ENGINE_by_id(optarg);
 			if (!engine) {
 				printf("No such engine: %s\n", optarg);
-- 
2.0.4

